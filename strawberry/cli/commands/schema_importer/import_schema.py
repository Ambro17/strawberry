import sys

import click

from graphql.error import GraphQLError

from strawberry.cli.commands.schema_importer import sdl_importer


@click.command(short_help="Converts SDL from a path to strawberry types")
@click.argument("schema", type=str, required=True)
def import_schema(schema):
    """Parses SDL to strawberry types and prints to console"""
    try:
        strawberry_code = transform_sdl_into_code(schema)
    except FileNotFoundError:
        print(f"File not found on path: {schema}")
        sys.exit(1)

    except GraphQLError:
        print(f"File {schema} contains syntax errors")
        sys.exit(1)

    print("# Code autogenerated by strawberry")
    click.echo(strawberry_code)


def transform_sdl_into_code(schema_path):
    sdl_string = sdl_importer.file_to_string(schema_path)
    strawberry_code = sdl_importer.import_sdl(sdl_string)
    return strawberry_code
